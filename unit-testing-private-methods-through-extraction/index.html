<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Unit testing private methods through extraction - Csharp and Game Development Notes</title><meta name="description" content="When you use unit tests you have to intentionally write code that is testable. What about private methods? How do you test those? And no, you should NOT change the&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://pilvimaa.fi/unit-testing-private-methods-through-extraction/"><link rel="alternate" type="application/atom+xml" href="https://pilvimaa.fi/feed.xml"><link rel="alternate" type="application/json" href="https://pilvimaa.fi/feed.json"><link rel="shortcut icon" href="https://pilvimaa.fi/media/website/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="https://pilvimaa.fi/assets/css/style.css?v=883afb3621d8d9edd7f006e174496a4d"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://pilvimaa.fi/unit-testing-private-methods-through-extraction/"},"headline":"Unit testing private methods through extraction","datePublished":"2022-07-24T14:32","dateModified":"2022-07-24T14:43","image":{"@type":"ImageObject","url":"https://pilvimaa.fi/media/posts/12/Bugs.jpg","height":672,"width":960},"description":"When you use unit tests you have to intentionally write code that is testable. What about private methods? How do you test those? And no, you should NOT change the&hellip;","author":{"@type":"Person","name":"Pilvinen","url":"https://pilvimaa.fi/authors/pilvinen/"},"publisher":{"@type":"Organization","name":"Pilvinen","logo":{"@type":"ImageObject","url":"https://pilvimaa.fi/media/website/Hedgehog.png","height":397,"width":640}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-NT7DGE75CF"></script><script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NT7DGE75CF');</script></head><body class="post-template"><header class="top js-header"><a class="logo" href="https://pilvimaa.fi/"><img src="https://pilvimaa.fi/media/website/Hedgehog.png" alt="Csharp and Game Development Notes" width="640" height="397"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://www.starandserpent.com" title="Star and Serpent" target="_blank">Star and Serpent</a></li><li><a href="https://www.starandserpent.com/blog/" title="S.&#x27;.S.&#x27;. blog" target="_blank">S.&#x27;.S.&#x27;. Blog</a></li><li><a href="https://github.com/starandserpent" title="S.&#x27;.S.&#x27;. Github" target="_blank">S.&#x27;.S.&#x27;. Github</a></li><li><a href="https://github.com/Pilvinen" title="Personal Github" target="_blank">Personal Github</a></li></ul></nav></header><main class="post"><article class="content"><div class="hero"><header class="hero__content"><div class="wrapper"><h1>Unit testing private methods through extraction</h1><div class="feed__meta content__meta"><img src="https://pilvimaa.fi/media/website/Pilvinen-As_Space_Techno_Wizard.png" loading="eager" height="1024" width="1024" class="feed__author-thumb" alt="Pilvinen"> <a href="https://pilvimaa.fi/authors/pilvinen/" class="feed__author">Pilvinen</a> <time datetime="2022-07-24T14:32" class="feed__date">July 24, 2022</time></div></div></header><figure class="hero__image"><div class="hero__image-wrapper"><img src="https://pilvimaa.fi/media/posts/12/Bugs.jpg" srcset="https://pilvimaa.fi/media/posts/12/responsive/Bugs-xs.jpg 640w, https://pilvimaa.fi/media/posts/12/responsive/Bugs-sm.jpg 768w, https://pilvimaa.fi/media/posts/12/responsive/Bugs-md.jpg 1024w, https://pilvimaa.fi/media/posts/12/responsive/Bugs-lg.jpg 1366w, https://pilvimaa.fi/media/posts/12/responsive/Bugs-xl.jpg 1600w, https://pilvimaa.fi/media/posts/12/responsive/Bugs-2xl.jpg 1920w" sizes="88vw" loading="eager" height="672" width="960" alt=""></div></figure></div><div class="entry-wrapper content__entry"><p>When you use unit tests you have to <em><strong>intentionally</strong></em> write code that is testable.</p><p>What about <code>private</code> methods? How do you test those?</p><p>And no, you <em><strong>should NOT</strong></em> change the accessibility of your methods (eg. <code>internal</code>, <code>public</code>, etc.) to make your code testable as you would lose your code’s correctness - there’s a reason why those <code>private</code> methods have been made <code>private</code>!</p><p>There are several ways to approach this problem. For example you could use the <code>PrivateObject</code> class. Or you could use <strong>reflection</strong>.</p><p>In this article, however, we are going to take a look at using <strong>extraction</strong> and good coding practices to make our <code>private</code> methods more accessible while also retaining our code’s correctness.</p><p>Let’s assume a situation where</p><pre><code class="language-cs">public class Player {
    
    private void Attack() {
        System.Console.WriteLine(&quot;Enemy takes damage!&quot;);
    }
    
    private void Move() {
        System.Console.WriteLine(&quot;You moved!&quot;);
    }
    
    public override void _PhysicsProcess(float delta) {
        Attack();
        Move();
    }
    
}
</code></pre><p>You can’t test the above methods, <code>Attack()</code> and <code>Move()</code>, because they are <code>private</code> and not exposed to the outside world. But you also want to keep it that way, it’s an important requirement.</p><p>Making the methods <code>public</code> would be bad. Using reflection to test the methods would work, but it’s not fun nor a good approach in general.</p><p>Let’s use <strong>method extraction</strong> instead and turn those methods into <strong>abstractions</strong>.</p><pre><code class="language-cs">public class RefactoredPlayer {
    private Attacker attacker;
    private Mover mover;

    public override void _PhysicsProcess(float delta) {
        attacker.Attack();
        mover.Move();
    }
}
</code></pre><p>What we’ve done here is we’ve refactored the <code>Player</code> class and extracted the <code>Attack()</code> and <code>Move()</code> methods into their own classes, <code>Attacker</code> and <code>Mover</code>. Now the <code>RefactoredPlayer</code> describes only the <em>flow of the code</em> and not it’s <em>implementation</em>, thus allowing us to keep the composed <code>attacker</code> and <code>mover</code> objects in the <code>RefactoredPlayer</code> class <code>private</code> while exposing the abstractions as <code>public</code> (see below).</p><pre><code class="language-cs">public abstract class Attacker {
    public abstract void Attack();
}

public abstract class Mover {
    public abstract void Move();
}
</code></pre><p><strong>IMPORTANT:</strong> We don’t have to test the <code>RefactoredPlayer</code> class anymore, we can now test the <em><strong>actual implementations</strong></em> of <code>Attacker</code> and <code>Mover</code> or the <em><strong>abstract classes</strong></em> themselves (for that you need to make an anonymous class implementation of your abstract class as you can’t instantiate an abstract class). Which one you want to do depends mostly on whether your actual implementations have extra features beyond the promises made in the <code>abstract</code> classes or not.</p><p>As a bonus you can now have several implementations of <code>Attacker</code> and <code>Mover</code> and depend upon <strong>abstractions</strong> instead of concrete implementations giving your <code>RefactoredPlayer</code> class less reasons to change and your code becomes more flexible.</p><pre><code class="language-cs">public class SwordAttack : Attacker {
    public override void Attack() {
        System.Console.WriteLine(&quot;You skewer the enemy with your sword!&quot;);
    }
}
</code></pre><p>Here we have an example of an actual implementation of one of our abstract classes. We would still want to depend upon the abstraction <code>Attacker</code> rather than the implementation <code>SwordAttack</code> - to make our code more fluid and easier to change. This way we don’t have to change our <code>RefactoredPlayer</code> class if our implementation changes or gets swapped out to something else that is also implementing the <code>abstract</code> class <code>Attacker</code>.</p></div><footer class="content__footer"><div class="entry-wrapper"><p class="content__updated">This article was updated on July 24, 2022</p><div class="content__actions"><ul class="content__tag"><li><a href="https://pilvimaa.fi/tag/c/">C#</a></li><li><a href="https://pilvimaa.fi/tag/unit-testing/">Unit Testing</a></li></ul></div><div class="content__bio bio"><img src="https://pilvimaa.fi/media/website/Pilvinen-As_Space_Techno_Wizard.png" loading="lazy" height="1024" width="1024" class="bio__avatar" alt="Pilvinen"><div><h3 class="h4 bio__name"><a href="https://pilvimaa.fi/authors/pilvinen/" rel="author">Pilvinen</a></h3><div class="bio__desc">Star and Serpent indie game studio founder, team leader, programmer wannabe, and game designer. Human friendly. Likes to talk. Interested in math, sciences, logic, languages, literature, medieval history, programming, philosophy, and games.</div></div></div></div><nav class="content__nav"><div class="wrapper"><div class="content__nav-inner"><div class="content__nav-prev"><a href="https://pilvimaa.fi/getting-godotxunit-up-and-running-with-rider/" class="content__nav-link" rel="prev"><figure class="content__nav-image"><img src="https://pilvimaa.fi/media/posts/11/responsive/Test-xs.jpg" class="lazyload" loading="lazy" alt="" height="695" width="695"></figure><div><span>Previous</span> Getting GodotXUnit up and Running with Rider</div></a></div><div class="content__nav-next"><a href="https://pilvimaa.fi/implicit-and-explicit-conversion-operators/" class="content__nav-link" rel="next"><div><span>Next</span> Implicit and explicit conversion operators</div><figure class="content__nav-image"><img src="https://pilvimaa.fi/media/posts/13/responsive/Spaghetti-xs.jpg" class="lazyload" loading="lazy" alt="" height="720" width="720"></figure></a></div></div></div></nav></footer></article><div class="content__related related"><div class="wrapper"><h2 class="h4 related__title">You should also read:</h2><article class="feed__item"><figure class="feed__image related__image"><img src="https://pilvimaa.fi/media/posts/11/Test.jpg" srcset="https://pilvimaa.fi/media/posts/11/responsive/Test-xs.jpg 640w, https://pilvimaa.fi/media/posts/11/responsive/Test-sm.jpg 768w, https://pilvimaa.fi/media/posts/11/responsive/Test-md.jpg 1024w" sizes="(min-width: 600px) calc(4.38vw + 143px), 87.86vw" loading="lazy" height="695" width="960" alt=""></figure><div class="feed__content"><header><div class="feed__meta"><img src="https://pilvimaa.fi/media/website/Pilvinen-As_Space_Techno_Wizard.png" loading="lazy" height="1024" width="1024" class="feed__author-thumb" alt="Pilvinen"> <a href="https://pilvimaa.fi/authors/pilvinen/" class="feed__author">Pilvinen</a> <time datetime="2022-07-18T17:54" class="feed__date">July 18, 2022</time></div><h3 class="feed__title"><a href="https://pilvimaa.fi/getting-godotxunit-up-and-running-with-rider/">Getting GodotXUnit up and Running with Rider</a></h3></header><p>Installation from Github These instructions will explain how to get GodotXUnit integrated to your project and working with Rider. [XunitTestCaseDiscoverer(&quot;GodotXUnitApi.Internal.GodotFactDiscoverer&quot;, &quot;GodotXUnitApi&quot;)] And replace the GodotXUnitApi with your project’s assembly name,&hellip;</p></div></article></div></div></main><footer class="footer footer--glued"><div class="wrapper"><div class="footer__copyright"><p><a href="https://www.starandserpent.com" target="_blank" rel="noopener noreferrer">https://www.starandserpent.com</a></p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg width="20" height="20"><use xlink:href="https://pilvimaa.fi/assets/svg/svg-map.svg#toparrow"/></svg></button></div></footer><script defer="defer" src="https://pilvimaa.fi/assets/js/scripts.min.js?v=ffcbea6c02c8178d10092962b235a5b0"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>